<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <title>AR Business Card | AdViz - QR Code Based</title>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; }
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: #000; overflow: hidden; }
        #canvas { display: block; width: 100%; height: 100%; }
        #video { display: none; }
        #hint { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); color: white; background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 20px; font-size: 12px; letter-spacing: 1px; text-transform: uppercase; border: 1px solid rgba(255,255,255,0.2); z-index: 10; }
        #splash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; }
        .splash-text { font-size: 28px; margin-bottom: 20px; font-weight: bold; }
        .splash-desc { font-size: 16px; margin-bottom: 30px; color: #aaa; }
        .btn { background: #00d2ff; color: #000; border: none; padding: 14px 40px; font-size: 16px; font-weight: bold; border-radius: 30px; cursor: pointer; box-shadow: 0 0 15px rgba(0, 210, 255, 0.5); transition: all 0.3s; }
        .btn:hover { background: #00b8d4; transform: scale(1.05); }
        .btn:active { transform: scale(0.95); }
        .watermark { position: fixed; top: 10px; right: 10px; color: rgba(255,255,255,0.5); font-size: 10px; z-index: 20; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <video id="video" playsinline></video>
    <div id="hint">Point camera at any QR code</div>
    <div class="watermark">AdViz.co AR</div>
    <div id="splash">
        <div class="splash-text">AR Business Card</div>
        <div class="splash-desc">Point your camera at any QR code</div>
        <button class="btn" id="start-btn" onclick="startAR()">Start Camera</button>
    </div>

    <script>
        let video, canvas, ctx;
        let qrDetected = false;
        let frameCount = 0;
        let detectionCooldown = 0;
        let lastQRCode = null;

        const buttons = [
            { x: 0, y: 0, label: 'Website', url: 'https://adviz.co', color: '#333' },
            { x: 0, y: 0, label: 'Email', url: 'mailto:hello@adviz.co', color: '#ea4335' },
            { x: 0, y: 0, label: 'LinkedIn', url: 'https://linkedin.com/company/adviz', color: '#0A66C2' }
        ];

        async function startAR() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }
                });

                video = document.getElementById('video');
                canvas = document.getElementById('canvas');
                ctx = canvas.getContext('2d');

                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                video.srcObject = stream;
                video.onloadedmetadata = () => {
                    video.play();
                    document.getElementById('splash').style.display = 'none';
                    animate();
                };
            } catch(err) {
                alert('Camera access denied. Please allow camera permissions.');
                console.error(err);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                frameCount++;
                detectionCooldown--;
                
                // QR detection every 4 frames
                if (frameCount % 4 === 0) {
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    try {
                        lastQRCode = jsQR(imageData.data, imageData.width, imageData.height);
                        if (lastQRCode) {
                            qrDetected = true;
                            detectionCooldown = 60;
                            document.getElementById('hint').textContent = 'QR Detected! âœ“';
                            document.getElementById('hint').style.borderColor = '#00d2ff';
                            document.getElementById('hint').style.color = '#00d2ff';
                        }
                    } catch(e) { }
                }
                
                if (detectionCooldown <= 0) {
                    qrDetected = false;
                    lastQRCode = null;
                    document.getElementById('hint').textContent = 'Point camera at any QR code';
                    document.getElementById('hint').style.borderColor = 'rgba(255,255,255,0.2)';
                    document.getElementById('hint').style.color = 'white';
                }
                
                if (qrDetected && lastQRCode) {
                    drawAR(lastQRCode);
                }
            }
        }

        function drawAR(code) {
            const loc = code.location;
            const cx = (loc.topLeftCorner.x + loc.bottomRightCorner.x) / 2;
            const cy = (loc.topLeftCorner.y + loc.bottomRightCorner.y) / 2;
            const size = Math.abs(loc.bottomRightCorner.x - loc.topLeftCorner.x);

            // Draw QR box
            ctx.strokeStyle = '#00d2ff';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(loc.topLeftCorner.x, loc.topLeftCorner.y);
            ctx.lineTo(loc.topRightCorner.x, loc.topRightCorner.y);
            ctx.lineTo(loc.bottomRightCorner.x, loc.bottomRightCorner.y);
            ctx.lineTo(loc.bottomLeftCorner.x, loc.bottomLeftCorner.y);
            ctx.closePath();
            ctx.stroke();

            // Animated circle
            const time = Date.now() / 500;
            const scale = 1 + Math.sin(time) * 0.2;
            ctx.strokeStyle = 'rgba(0, 210, 255, 0.8)';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(cx, cy - size * 0.8, size * 0.4 * scale, 0, Math.PI * 2);
            ctx.stroke();

            // Title
            ctx.fillStyle = '#00d2ff';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('AdViz', cx, cy - size * 0.8);

            // Draw buttons
            const spacing = size * 0.45;
            const btnY = cy + size * 0.5;

            buttons[0].x = cx - spacing;
            buttons[0].y = btnY;
            drawButton(buttons[0]);

            buttons[1].x = cx;
            buttons[1].y = btnY;
            drawButton(buttons[1]);

            buttons[2].x = cx + spacing;
            buttons[2].y = btnY;
            drawButton(buttons[2]);
        }

        function drawButton(btn) {
            ctx.fillStyle = btn.color;
            ctx.beginPath();
            ctx.arc(btn.x, btn.y, 50, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(btn.x, btn.y, 50, 0, Math.PI * 2);
            ctx.stroke();
            ctx.fillStyle = 'white';
            ctx.font = 'bold 13px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(btn.label, btn.x, btn.y);
        }

        canvas.addEventListener('click', (e) => {
            if (!qrDetected) return;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            buttons.forEach(btn => {
                const dx = x - btn.x;
                const dy = y - btn.y;
                if (Math.sqrt(dx*dx + dy*dy) < 50) {
                    window.open(btn.url, '_blank');
                }
            });
        });

        window.startAR = startAR;
    </script>
</body>
</html>
